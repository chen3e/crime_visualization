<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>CrimeMapper</title>
    <base href="/">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="assets/img/crimeMapperIcon.png">
</head>
<body>
    <app-root></app-root>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Google maps JS -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAt7vqsxxzPKE6DPsHGF59JZfBZ-BOYBb0&libraries=visualization"
    async defer></script>

    <script>
        let crimes = [];

        var map;
        // This function is the callback defined in script url callback= parameter. MUST MATCH
        var map, heatmap;
        function initMap() {
            var chicago = { lat: 41.8974, lng: -87.6352 };
            var heatmapData = [
                { location: new google.maps.LatLng(41.897, -87.635), weight: 1000 },
                { location: new google.maps.LatLng(41.897, -87.637), weight: 1000 },
                { location: new google.maps.LatLng(41.897, -87.639), weight: 1000 },
                { location: new google.maps.LatLng(41.897, -87.641), weight: 1000 },
                { location: new google.maps.LatLng(41.890, -87.637), weight: 1000 },
                { location: new google.maps.LatLng(41.890, -87.638), weight: 1000 },
                { location: new google.maps.LatLng(41.890, -87.630), weight: 1000 },
                { location: new google.maps.LatLng(41.890, -87.632), weight: 1000 },
                { location: new google.maps.LatLng(41.890, -87.633), weight: 1000 },
            ];
            for (let i = 0; i < crimes.length; i++) {
                heatmapData.push({ location: new google.maps.LatLng(Number(crimes[i].latitude), Number(crimes[i].longitude)), weight: 1000 });
            }
            console.log(heatmapData)
            map = new google.maps.Map(document.getElementById('map'), {
                center: chicago,
                zoom: 16
            });
            var marker = new google.maps.Marker({ position: chicago, map: map });
            heatmap = new google.maps.visualization.HeatmapLayer({
                data: heatmapData,
                map: map
            });
        }
        function toggleHeatmap() {
            heatmap.setMap(heatmap.getMap() ? null : map);
        }
        function changeGradient() {
            var gradient = [
                'rgba(0, 255, 255, 0)',
                'rgba(0, 255, 255, 1)',
                'rgba(0, 191, 255, 1)',
                'rgba(0, 127, 255, 1)',
                'rgba(0, 63, 255, 1)',
                'rgba(0, 0, 255, 1)',
                'rgba(0, 0, 223, 1)',
                'rgba(0, 0, 191, 1)',
                'rgba(0, 0, 159, 1)',
                'rgba(0, 0, 127, 1)',
                'rgba(63, 0, 91, 1)',
                'rgba(127, 0, 63, 1)',
                'rgba(191, 0, 31, 1)',
                'rgba(255, 0, 0, 1)'
            ]
            heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
        }
        function changeRadius() {
            heatmap.set('radius', heatmap.get('radius') ? null : 20);
        }
        function changeOpacity() {
            heatmap.set('opacity', heatmap.get('opacity') ? null : 0.2);
        }

        $.ajax({
            //https://yourmapper2.p.mashape.com/markers?&f=json&id=182&minlat=41.645&maxlat=41.646&minlon=-87.531&maxlon=-87.530&start=2012-12-01&end=2012-12-31num=500
            url: "https://yourmapper2.p.mashape.com/markers?center=0&f=json&id=182&lat=41.881&lon=-87.623&num=5000",
            //url: "https://yourmapper2.p.mashape.com/markers?center=0&f=json&id=182&lat=41.881&lon=-87.623&num=5000",
            headers: { "X-Mashape-Key": "fNutKhjM8Smshcjz2VSdocmRagjMp1ro8g6jsnnRhXEuIpICA4", "Accept": "application/json" },
            type: "GET",
            success: function (data) {
                console.log("Success!");
                crimes = JSON.parse(data)['items'];
                console.log("First crimes:",crimes);
/*                 $.ajax({
                    url: "https://yourmapper2.p.mashape.com/markers?&f=json&id=182&minlat=41.650&maxlat=41.655&minlon=-87.525&maxlon=-87.520&start=2012-12-01&end=2012-12-31num=500",
                    headers: { "X-Mashape-Key": "rSCiGbEc2amshYK4i3bGFu9ltLZWp1D9W11jsnoxBKLY0ixRyW", "Accept": "application/json" },
                    type: "GET",
                    success: function (data) {
                        secondCrimes = JSON.parse(data)['items'];
                        for (var i = 0; i < secondCrimes.length; i++){
                            crimes.push(secondCrimes[i]);
                        }
                        console.log("Second crimes:", crimes);
                    }
                }) */
                initMap();
            }
        });

        $(document).ready(function () {
            $("#searchBar").hide();
            let showSearch = false;
            $("#showSearch").click(function () {
                $("#searchBar").slideToggle();
                if (!showSearch) {
                    $(this).html("Hide Search")
                    showSearch = true;
                }
                else {
                    $(this).html("Filter Results");
                    showSearch = false;
                }
            })
        });
    </script>
</body>
</html>